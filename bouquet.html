<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Bouquet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { 
            margin: 0; height: 100vh; background: #fafafa; 
            font-family: 'Helvetica Neue', sans-serif; overflow: hidden; 
            display: flex; flex-direction: column; align-items: center;
        }

        /* The Vase Backdrop */
        #canvas-container {
            position: relative; width: 100vw; height: 70vh;
            display: flex; justify-content: center; align-items: flex-end;
        }

        .glass-vase {
            position: absolute; bottom: 50px; width: 220px; height: 300px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-top: none;
            border-radius: 0 0 80px 80px;
            z-index: 10; pointer-events: none;
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        }

        .controls {
            height: 30vh; width: 100%; background: white;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; gap: 20px; z-index: 20;
            border-top: 1px solid #eee;
        }

        .flower-options { display: flex; gap: 25px; }

        .flower-btn {
            font-size: 40px; cursor: pointer; background: #fdfdfd;
            border: 1px solid #eee; padding: 15px; border-radius: 20px;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1;
        }

        .flower-btn:hover { transform: scale(1.2); border-color: #fbbf24; }
        .flower-btn:active { transform: scale(0.9); }

        .next-btn {
            padding: 15px 40px; background: #333; color: white;
            border: none; border-radius: 0; letter-spacing: 4px;
            text-transform: uppercase; font-size: 0.7rem; cursor: pointer;
            transition: 0.4s;
        }
        .next-btn:hover { background: #fbbf24; color: #333; }

        h2 { font-weight: 300; letter-spacing: 3px; color: #888; text-transform: uppercase; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="canvas-container">
        <div class="glass-vase"></div>
    </div>

    <div class="controls">
        <h2>Compose your arrangement</h2>
        <div class="flower-options">
            <div class="flower-btn" onclick="addFlower('ðŸŒ»')">ðŸŒ»</div>
            <div class="flower-btn" onclick="addFlower('ðŸŒ·')">ðŸŒ·</div>
            <div class="flower-btn" onclick="addFlower('ðŸŒ¸')">ðŸŒ¸</div>
            <div class="flower-btn" onclick="addFlower('ðŸŒ¹')">ðŸŒ¹</div>
            <div class="flower-btn" onclick="addFlower('ðŸŒ¿')">ðŸŒ¿</div>
        </div>
        <button class="next-btn" onclick="window.location.href='ask.html'">Complete Selection</button>
    </div>

    <audio id="bg-music" loop><source src="yellow.mp3" type="audio/mpeg"></audio>

    <script>
        // 1. Matter.js Setup
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint } = Matter;
        const engine = Engine.create();
        const world = engine.world;

        const container = document.getElementById('canvas-container');
        const render = Render.create({
            element: container,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight * 0.7,
                wireframes: false,
                background: 'transparent'
            }
        });

        // 2. Create Vase Boundaries (Invisible collision boxes)
        const ground = Bodies.rectangle(window.innerWidth/2, 650, 220, 40, { isStatic: true, render: { visible: false } });
        const leftWall = Bodies.rectangle(window.innerWidth/2 - 110, 500, 20, 300, { isStatic: true, angle: -0.1, render: { visible: false } });
        const rightWall = Bodies.rectangle(window.innerWidth/2 + 110, 500, 20, 300, { isStatic: true, angle: 0.1, render: { visible: false } });

        Composite.add(world, [ground, leftWall, rightWall]);

        // 3. Add Flower Function
        function addFlower(emoji) {
            const x = window.innerWidth / 2 + (Math.random() * 40 - 20);
            const y = 100;

            const flower = Bodies.circle(x, y, 25, {
                restitution: 0.5, // Bounciness
                friction: 0.1,
                render: {
                    sprite: {
                        texture: createEmojiTexture(emoji),
                        xScale: 1,
                        yScale: 1
                    }
                }
            });

            Composite.add(world, flower);
        }

        // Helper to turn Emoji into a Texture for Physics
        function createEmojiTexture(emoji) {
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.font = '50px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, 32, 32);
            return canvas.toDataURL();
        }

        // 4. Run Physics
        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        // Music
        if (sessionStorage.getItem('musicPlaying') === 'true') document.getElementById('bg-music').play();
    </script>
</body>
</html>